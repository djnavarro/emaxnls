# emaxnls

The **emaxnls** package provides tools for nonlinear least squares
estimation for Emax regression models.

## Installation

You can install the development version of emaxnls from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("djnavarro/emaxnls")
```

## Minimal example

``` r
library(tibble)
library(emaxnls)
set.seed(123)

emax_df
#> # A tibble: 400 × 10
#>     dose exposure_1 exposure_2 response_1 response_2 cnt_a cnt_b cnt_c bin_d
#>    <dbl>      <dbl>      <dbl>      <dbl>      <dbl> <dbl> <dbl> <dbl> <dbl>
#>  1     0          0          0       6.49          0  3.06  6.50 5.93      0
#>  2     0          0          0       7.81          0  5.72  3.84 5.60      0
#>  3     0          0          0       7.26          0  4.31  3.68 8.16      0
#>  4     0          0          0       7.45          0  4.03  2.86 9.38      1
#>  5     0          0          0       6.33          0  2.46  3.36 8.29      0
#>  6     0          0          0       7.13          0  4.87  8.90 7.06      0
#>  7     0          0          0       6.07          0  2.87  4.85 0.989     0
#>  8     0          0          0       5.47          1  1.07  5.34 3.34      1
#>  9     0          0          0       7.12          0  3.94  5.68 4.01      1
#> 10     0          0          0       8.21          1  7.46  8.16 6.92      1
#> # ℹ 390 more rows
#> # ℹ 1 more variable: bin_e <dbl>

emax_nls(
  structural_model = response_1 ~ exposure_1, 
  covariate_model = list(E0 ~ cnt_a, Emax ~ 1, logEC50 ~ 1), 
  data = emax_df
)
#> Structural model:
#> 
#>   Exposure:  exposure_1 
#>   Response:  response_1 
#>   Emax type: hyperbolic 
#> 
#> Covariate model:
#> 
#>   E0:       E0 ~ cnt_a 
#>   Emax:     Emax ~ 1 
#>   logEC50:  logEC50 ~ 1 
#> 
#> Coefficient table:
#> 
#>   label             estimate std_error t_statistic   p_value ci_lower ci_upper
#> 1 E0_Intercept         4.99     0.0740        67.5 3.21e-219    4.85     5.14 
#> 2 E0_cnt_a             0.498    0.0113        44.2 4.30e-155    0.476    0.520
#> 3 Emax_Intercept      10.0      0.104         96.3 7.23e-277    9.80    10.2  
#> 4 logEC50_Intercept    8.27     0.0366       226.  0            8.19     8.34 
#> 
#> Variance-covariance matrix:
#> 
#>                   E0_Intercept E0_cnt_a Emax_Intercept logEC50_Intercept
#> E0_Intercept           0.00548 -6.2e-04       -2.2e-03           4.3e-04
#> E0_cnt_a              -0.00062  1.3e-04        4.2e-05           2.5e-05
#> Emax_Intercept        -0.00224  4.2e-05        1.1e-02           2.6e-03
#> logEC50_Intercept      0.00043  2.5e-05        2.6e-03           1.3e-03
```

## Stepwise covariate modelling

``` r
base_model <- emax_nls(
  structural_model = response_1 ~ exposure_1, 
  covariate_model = list(E0 ~ 1, Emax ~ 1, logEC50 ~ 1), 
  data = emax_df
)

covariate_list <- list(
  E0 = c("cnt_a", "cnt_b", "cnt_c", "bin_d", "bin_e"),
  Emax = c("cnt_a", "cnt_b", "cnt_c", "bin_d", "bin_e")
)

final_mod <- base_model |> 
  emax_forward(candidates = covariate_list, threshold = .01) |> 
  emax_backward(candidates = covariate_list, threshold = .001) 

emax_history(final_mod)
#> # A tibble: 32 × 9
#>    iteration attempt step       action term_tested  model_tested model_converged
#>        <int>   <int> <chr>      <chr>  <chr>        <chr>        <lgl>          
#>  1         0       0 base model <NA>   <NA>         E0 ~ 1, Ema… FALSE          
#>  2         1       1 forward    add    E0 ~ cnt_c   E0 ~ 1 + cn… TRUE           
#>  3         1       2 forward    add    Emax ~ bin_e E0 ~ 1, Ema… TRUE           
#>  4         1       3 forward    add    E0 ~ cnt_b   E0 ~ 1 + cn… TRUE           
#>  5         1       4 forward    add    Emax ~ cnt_c E0 ~ 1, Ema… TRUE           
#>  6         1       5 forward    add    Emax ~ cnt_a E0 ~ 1, Ema… TRUE           
#>  7         1       6 forward    add    Emax ~ bin_d E0 ~ 1, Ema… TRUE           
#>  8         1       7 forward    add    E0 ~ cnt_a   E0 ~ 1 + cn… TRUE           
#>  9         1       8 forward    add    Emax ~ cnt_b E0 ~ 1, Ema… TRUE           
#> 10         1       9 forward    add    E0 ~ bin_e   E0 ~ 1 + bi… TRUE           
#> # ℹ 22 more rows
#> # ℹ 2 more variables: term_p_value <dbl>, model_updated <lgl>

final_mod
#> Structural model:
#> 
#>   Exposure:  exposure_1 
#>   Response:  response_1 
#>   Emax type: hyperbolic 
#> 
#> Covariate model:
#> 
#>   E0:       E0 ~ 1 + cnt_a 
#>   Emax:     Emax ~ 1 
#>   logEC50:  logEC50 ~ 1 
#> 
#> Coefficient table:
#> 
#>   label             estimate std_error t_statistic   p_value ci_lower ci_upper
#> 1 E0_Intercept         4.99     0.0740        67.5 3.21e-219    4.85     5.14 
#> 2 E0_cnt_a             0.498    0.0113        44.2 4.30e-155    0.476    0.520
#> 3 Emax_Intercept      10.0      0.104         96.3 7.23e-277    9.80    10.2  
#> 4 logEC50_Intercept    8.27     0.0366       226.  0            8.19     8.34 
#> 
#> Variance-covariance matrix:
#> 
#>                   E0_Intercept E0_cnt_a Emax_Intercept logEC50_Intercept
#> E0_Intercept           0.00548 -6.2e-04       -2.2e-03           4.3e-04
#> E0_cnt_a              -0.00062  1.3e-04        4.2e-05           2.5e-05
#> Emax_Intercept        -0.00224  4.2e-05        1.1e-02           2.6e-03
#> logEC50_Intercept      0.00043  2.5e-05        2.6e-03           1.3e-03
```

## Simulation

``` r
simulate(final_mod, nsim = 1)
#> # A tibble: 400 × 8
#>    dat_id sim_id    mu   val E0_Intercept E0_cnt_a Emax_Intercept
#>     <int>  <int> <dbl> <dbl>        <dbl>    <dbl>          <dbl>
#>  1      1      1  6.51  6.86         4.96    0.508           10.1
#>  2      2      1  7.87  8.14         4.96    0.508           10.1
#>  3      3      1  7.15  7.12         4.96    0.508           10.1
#>  4      4      1  7.00  6.85         4.96    0.508           10.1
#>  5      5      1  6.21  6.02         4.96    0.508           10.1
#>  6      6      1  7.43  7.09         4.96    0.508           10.1
#>  7      7      1  6.42  6.31         4.96    0.508           10.1
#>  8      8      1  5.50  4.87         4.96    0.508           10.1
#>  9      9      1  6.96  8.04         4.96    0.508           10.1
#> 10     10      1  8.75  9.35         4.96    0.508           10.1
#> # ℹ 390 more rows
#> # ℹ 1 more variable: logEC50_Intercept <dbl>
```

# Package index

## Build

Build Emax regression models

- [`emax_nls()`](https://emaxnls.djnavarro.net/reference/emax_nls.md) :
  Emax model with arbitrary covariates (does not support interactions)
- [`emax_forward()`](https://emaxnls.djnavarro.net/reference/emax_scm.md)
  [`emax_backward()`](https://emaxnls.djnavarro.net/reference/emax_scm.md)
  [`emax_history()`](https://emaxnls.djnavarro.net/reference/emax_scm.md)
  : Stepwise covariate modelling for Emax regression
- [`emax_add_term()`](https://emaxnls.djnavarro.net/reference/emax_update.md)
  [`emax_remove_term()`](https://emaxnls.djnavarro.net/reference/emax_update.md)
  : Add or remove a covariate term from an Emax regression

## Methods

Methods for Emax regression objects

- [`print(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/print.emaxnls.md)
  : Print an Emax regression model object
- [`coef(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/coef.emaxnls.md)
  : Coefficents for an Emax regression
- [`vcov(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/vcov.emaxnls.md)
  : Variance-covariance matrix for an Emax regression
- [`confint(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/confint.emaxnls.md)
  : Confidence intervals for Emax regression model parameters
- [`residuals(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/residuals.emaxnls.md)
  : Residuals for an Emax regression
- [`logLik(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/logLik.emaxnls.md)
  : Log-likelihood for an Emax regression model
- [`AIC(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/AIC.md)
  [`BIC(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/AIC.md)
  : Akaike information criterion / Bayesian information criterion
- [`anova(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/anova.emaxnls.md)
  : Analysis of variance for Emax regression models
- [`simulate(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/simulate.emaxnls.md)
  : Simulate responses from Emax regression model
- [`predict(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/predict.emaxnls.md)
  : Predicting from Emax regression models
- [`deviance(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/deviance.emaxnls.md)
  : Model deviance for an Emax regression
- [`df.residual(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/df.residual.emaxnls.md)
  : Residual degrees of freedom for an Emax regression model
- [`fitted(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/fitted.emaxnls.md)
  : Fitted values for an Emax regression
- [`nobs(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/nobs.emaxnls.md)
  : Number of observations for an Emax regression model
- [`sigma(`*`<emaxnls>`*`)`](https://emaxnls.djnavarro.net/reference/sigma.emaxnls.md)
  : Residual standard deviation for Emax regression models

## Other

Other exported objects

- [`emax_df`](https://emaxnls.djnavarro.net/reference/emax_df.md) :
  Sample simulated data for Emax exposure-response models with
  covariates.

